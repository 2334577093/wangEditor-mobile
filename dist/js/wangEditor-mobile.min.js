/*! wangEditor-mobile.js 2015-12-07 */
!function(a){a.___E_mod=function(b){var c=a.___E;null!=c&&b(c,a.Zepto)}}(window),function(a){var b=a.Zepto,c=a.___E,d="github.com/wangfupeng1988/wangEditor-mobile";if(null!=c){if(c.gitlink===d)return void alert("不得重复引用wangEditor的js文件");if(!c.gitlink||c.gitlink!==d)return void alert("window.___E 属性名已经被其他程序占用。wangEditor-mobile引用失败")}return null==b?void alert("wangEditor-mobile依赖于zepto，请先引用zepto.js"):document.createRange&&"function"==typeof document.createRange?void 0:void alert("当前浏览器不支持document.createRange，不能生成富文本编辑器")}(window),function(a,b){var c="github.com/wangfupeng1988/wangEditor-mobile",d=function(a){var c=this;c.$body=b("body");var d=b("#"+a);c.$textarea=d,c.checkTapTime=function(a,d){var e,f,g=!0;return a?(e=a.currentTarget||a.target,f=b(e)):f=c.$body,null==f.data("tapTime")?(f.data("tapTime",Date.now().toString()),g=!0):Date.now()-parseInt(f.data("tapTime"))<100?(a.preventDefault(),a.stopPropagation(),g=!1):(f.data("tapTime",Date.now().toString()),g=!0),g},c.initDefaultConfig(),c.addTxt(),c.addMenus()};d.fn=d.prototype,d.fn.gitlink=c,d.log=function(b,c){a.console?c?console.log(b,c):console.log(b):(alert(b),c&&alert(c))},d.warn=function(b,c){a.console?c?console.warn(b,c):console.warn(b):(alert(b),c&&alert(c))},a.___E=d}(window,window.Zepto),window.___E_mod(function(a,b){a.config={}}),window.___E_mod(function(a,b){a.fn.initDefaultConfig=function(){var a=this;a.config={menuColorValue:"red",menuQuoteStyle:{display:"block","border-left":"5px solid #d0e5f2",padding:"4px 0 4px 10px","background-color":"#f1f1f1",margin:"4px 0"},menus:["head","bold","color","quote","list","img","happy"],happy:["http://wangeditor.github.io/expressions/1.gif","http://wangeditor.github.io/expressions/2.gif","http://wangeditor.github.io/expressions/3.gif","http://wangeditor.github.io/expressions/4.gif","http://wangeditor.github.io/expressions/5.gif","http://wangeditor.github.io/expressions/6.gif","http://wangeditor.github.io/expressions/7.gif","http://wangeditor.github.io/expressions/8.gif","http://wangeditor.github.io/expressions/9.gif","http://wangeditor.github.io/expressions/10.gif","http://wangeditor.github.io/expressions/11.gif","http://wangeditor.github.io/expressions/12.gif","http://wangeditor.github.io/expressions/13.gif","http://wangeditor.github.io/expressions/14.gif","http://wangeditor.github.io/expressions/15.gif","http://wangeditor.github.io/expressions/16.gif","http://wangeditor.github.io/expressions/17.gif","http://wangeditor.github.io/expressions/18.gif","http://wangeditor.github.io/expressions/19.gif","http://wangeditor.github.io/expressions/20.gif"],uploadImgUrl:"/upload",testHostname:"localhost",tapNumForHideMenu:3}}}),window.___E_mod(function(a,b){a.fn.addTxt=function(){var a=this,c=a.$textarea,d=b.trim(c.val()),e=b('<div contentEditable="true" class="wangEditor-mobile-txt">'+d+"</div>"),f=b('<div class="wangEditor-mobile-modal-container"></div>');a.$txt=e,a.$modalContainer=f,a.insertEmpltyLink()}}),window.___E_mod(function(a,b){a.fn.addMenus=function(){var a=this,c=b('<div class="wangEditor-mobile-menu-container" contentEditable="false"></div>'),d=b('<div class="item-container"></div>'),e=b('<div class="tip"></div>');c.append(e),c.append(d);var f=b('<div class="wangEditor-mobile-menu-container-open-btn"  contentEditable="false"></div>'),g=b('<div class="item-container"> <div class="item"><a href="#"><i class="icon-wangEditor-m-ellipsis-h"></i></a></div> </div>');f.append(g),f.append(e.clone()),a.$menuContainer=c,a.$menuItemContainer=d,a.$menuContainerOpenBtn=f,a.menus={},a.addMenuBold("bold"),a.addMenuHead("head"),a.addMenuColor("color"),a.addMenuQuote("quote"),a.addMenuList("list"),a.addMenuCheck("check"),a.addMenuHappy("happy"),a.addMenuImg("img")}}),window.___E_mod(function(a,b){a.fn.addMenuBold=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-bold"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"bold")!==!1&&c.command("bold",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("bold")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuHead=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-header"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"head")!==!1&&(b.selected?c.command("formatblock",!1,"p",a):c.command("formatblock",!1,"h3",a))})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^h\d{1}$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuColor=function(a){var c=this,d=c.menus,e=c.config.menuColorValue;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-brush"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this,d=b.$trigger;d.on("singleTap",function(a){if(c.checkTapTime(a,"color")!==!1){var d=e;b.selected&&(d="#000"),c.command("forecolor",!1,d,a)}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("forecolor");"rgb(0, 0, 0)"!==d?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuQuote=function(a){var c=this,d=c.menus,e=(c.$txt,c.config.menuQuoteStyle);d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-quote-left"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=this;d.$trigger.on("singleTap",function(a){if(c.checkTapTime(a,"quote")!==!1){var f,g,h,i=c.$focusElem;if(d.selected){if(f="BLOCKQUOTE"===i.get(0).nodeName?i:i.closest("blockquote"),0===f.length)return;g=f.text(),h=function(){var a=b("<p>"+g+"</p>");f.after(a),f.remove()},c.customCommand(!1,h,a)}else c.command("formatblock",!1,"blockquote",a),c.$txt.find("blockquote").each(function(a,c){var d=b(c),f="w_editor_quote_style",g=d.attr(f);null==g&&(d.css(e),d.attr(f,"1"))})}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^blockquote$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuList=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-list-ul"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"list")!==!1&&c.command("InsertUnorderedList",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("InsertUnorderedList")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuCheck=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-checkbox-checked"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=Date.now(),e=this;e.$trigger.on("singleTap",function(a){if(c.checkTapTime(a,"check")!==!1){var e=b('<input type="checkbox"/>'),f=b("<p></p>");f.append(e).append("&nbsp;&nbsp;"),e.on("singleTap",function(a){if(!(Date.now()-d<50)){d=Date.now();var c=b(a.target),e=c.is(":checked");c.prop("checked",!e),a.preventDefault(),a.stopPropagation()}});var g=function(){c.$focusElem.after(f)};c.customCommand(!1,g,a)}})},updateStyle:function(a){}}}}),window.___E_mod(function(a,b){a.fn.addMenuHappy=function(c){var d=this,e=d.$body,f=d.menus,g=d.config.happy,h=d.$txt;g.length>0&&0===g[0].indexOf("http://wangeditor.github.io/expressions")&&(a.warn("正在使用wangEdior提供的免费表情图标，它们将从 github 下载，速度很慢！！！"),a.warn("建议将表情图标重新配置，请参见文档说明")),f[c]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-happy"></i></a>'),$wrap:b('<div class="item"</div>'),$modal:b('<div class="wangEditor-mobile-modal"></div>'),renderModal:function(){var a=this,c=a.$modal,f='<a href="#" class="command-link" commandValue="#{imgUrl}"><img src="#{imgUrl}"/></a>',h=[];b.each(g,function(a,b){h.push(f.replace(/#{imgUrl}/gi,b))}),c.append(h.join("")),e.append(c);var i=c.width();c.css("margin-left",(0-i)/2),c.on("singleTap",".command-link",function(c){if(d.checkTapTime(c,"happy command-link")!==!1){var e=b(c.currentTarget),f=e.attr("commandValue");d.command("InsertImage",!1,f,c),a.hideModal()}})},showModal:function(){var a=this;a.$modal.show();var b=function(c){a.hideModal(),h.off("singleTap",b)};h.on("singleTap",b)},hideModal:function(){this.$modal.hide()},bindEvent:function(a){function b(){e.renderModal(),e.showModal()}function c(){e.showModal()}var e=this,f=e.$trigger;e.$modal;f.one("singleTap",function(a){d.checkTapTime(a,"happy one")!==!1&&d.customCommand(!0,b,a)}),f.on("singleTap",function(a){d.checkTapTime(a,"happy on")!==!1&&d.customCommand(!0,c,a)})},updateStyle:function(){}}}}),window.___E_mod(function(a,b){a.fn.addMenuImg=function(c){function d(b){k&&a.log(b)}var e=this,f=e.$body,g=e.menus,h=e.config,i=h.uploadImgUrl||"",j=h.testHostname||"localhost",k=j===location.hostname;""===i&&alert("没有配置 uploadImgUrl ，wangEditor 将无法上传图片。\n\n想要配置上传图片，请参见文档说明。\n\n不想要图片上传，可通过配置 menus 隐藏该功能。");var l="iframe"+Math.random().toString().slice(2),m="form"+Math.random().toString().slice(2),n="inputfile"+Math.random().toString().slice(2);g[c]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-picture"></i></a>'),$wrap:b('<div class="item"</div>'),renderIframe:function(){var a='<iframe id="'+l+'" name="'+l+'" style="display:none; width:0; height:0;"></iframe>',c=b('<div style="display:none;"></div>');c.html(a),f.append(c);var g=b("#"+l).get(0);g.onload=function(){var a=g.contentDocument.body.innerHTML;return"error"===a?(d("服务器端返回了数据，很遗憾返回的是 error"),d("请关注弹出的错误提示，或者去服务器后台跟踪代码，排查问题"),d("结束..."),void alert("上传错误")):(d("成功接收到服务器端返回的数据"),d("服务器端返回的数据是："+a),d("请确认以上数据是否是一个 image 的 url 地址，如果不是将无法显示 image"),d("即将显示 image"),e.command("insertimage",!1,a),void d("结束..."))}},renderForm:function(){var a=['<form id="'+m+'" target="'+l+'"','    action="'+i+'"','    enctype="multipart/form-data"','    method="post">','    <input id="'+n+'" name="wangEditorMobileFile" type="file" accept="image/*" capture="camera">',"</form>"].join(""),c=b('<div style="display:none;"></div>');c.html(a),f.append(c)},bindEvent:function(a){var c=this,f=c.$trigger;c.renderIframe(),c.renderForm();var g=b("#"+n),h=b("#"+m);g.on("change",function(a){h.submit(),d("已经选中文件，并提交了 form"),d("如果接下来得不到 log 信息，则证明服务器端没有返回数据")}),f.on("singleTap",function(a){function b(){g.trigger("click")}e.checkTapTime(a,"img")!==!1&&""!==i&&e.customCommand(!0,b,a)})},updateStyle:function(){}}}}),window.___E_mod(function(a,b){a.fn.renderTxt=function(){var a=this,b=a.$textarea,c=a.$txt,d=a.$modalContainer,e=a.$body;b.after(c),b.hide(),e.append(d)}}),window.___E_mod(function(a,b){a.fn.renderMenu=function(){var a=this,c=a.menus,d=a.$menuContainer,e=a.$menuItemContainer,f=a.$menuContainerOpenBtn,g=a.$txt,h=b('<div class="gap"></div>'),i=(a.$body,a.config.menus);b.each(i,function(a,b){var d=c[b];if(null!=d){var f=d.$trigger,g=d.$wrap;f&&(g?(g.append(f),e.append(g)):e.append(f),e.append(h.clone()))}}),e.children().last().remove(),d.hide(),f.hide(),a.menuDisplayShow=!1,g.prepend(d),a.showMenu=!1,g.prepend(f)}}),window.___E_mod(function(a,b){a.fn.bindDocumentEvent=function(){var a=b(document),c=this,d=(c.$txt,Date.now());a.on("scroll",function(a){Date.now()-d<=50||(d=Date.now(),c.hideMenuContainer())}),a.on("tap",function(a){})}}),window.___E_mod(function(a,b){a.fn.bindTxtEvent=function(){function a(){var a,d;c.saveSelection(),a=c.getWrapRangeElem(),a&&(d=b(a),d.addClass("focus-elem"),c.$focusElem=d),c.updateMenuStyle()}var c=this,d=c.$txt,e=c.$menuContainer,f=e.get(0),g=c.$menuContainerOpenBtn,h=g.get(0),i=Date.now();d.on("focus",function(){c.isFocus=!0}),d.on("singleTap",function(d){if(c.checkTapTime(d,"$txt")!==!1&&c.isFocus){var e=b(d.target);if(c.eventTarget(e),e.hasClass("focus-elem"))return void c.hideMenuContainer();if(e.hasClass("wangEditor-mobile-txt"))return void c.hideMenuContainer();c.setTapNumForHideMenu("tap"),c.setMenuContainerPosition();var f=c.$focusElem;f&&f.removeClass("focus-elem"),setTimeout(a,c.txtTapDelay),c.txtTapDelay=100,d.stopPropagation()}}),d.on("scroll",function(a){Date.now()-i<=50||(i=Date.now(),c.hideMenuContainer(),a.stopPropagation())}),d.on("keydown",function(a){c.hideMenuContainer()}),d.on("longTap, doubleTap",function(){c.hideMenuContainer()}),d.on("blur",function(a){c.isFocus=!1;var b=c.focusTxt,d=a.explicitOriginalTarget;if(f.contains(d)||h.contains(d))return setTimeout(b.call(c),300),void a.preventDefault();var e=a.relatedTarget;return null!=e?(setTimeout(b.call(c),300),void a.preventDefault()):(c.saveSourceCode(),void c.hideMenuContainer())}),d.on("click",function(a){a.preventDefault(),a.stopPropagation()})}}),window.___E_mod(function(a,b){a.fn.bindMenuContainerEvent=function(){var a=this,b=a.$menuContainer,c=a.$menuClose;b.on("tap",function(a){a.preventDefault(),a.stopPropagation()}),null!=c&&c.on("singleTap",function(b){a.checkTapTime(b,"$menuClose")!==!1&&(a.hideMenuByOpenBtn(),b.preventDefault(),b.stopPropagation())})},a.fn.bindMenuContainerOpenBtnEvent=function(){var a=this,b=a.$menuContainerOpenBtn;a.$menuContainer;b.find("a").on("singleTap",function(b){a.checkTapTime(b,"$menuContainerOpenBtn")!==!1&&(a.showMenuByOpenBtn(),b.preventDefault(),b.stopPropagation())})}}),window.___E_mod(function(a,b){a.fn.bindMenuBtnEvent=function(){var a=this,c=a.menus;b.each(c,function(b,c){var d=c.bindEvent;d&&"function"==typeof d&&d.call(c,a)})}}),window.___E_mod(function(a,b){a.fn.focusTxt=function(){var a=this,b=a.$txt;a.isFocus||b.focus()},a.fn.eventTarget=function(a){var b=this;return null==a?b.$eventTargetElem:void(b.$eventTargetElem=a)},a.fn.saveSourceCode=function(){var a=this,b=a.$txt,c=a.$textarea,d="",e=b.clone(),f=e.find(".focus-elem");f.removeClass("focus-elem"),d=e.html(),c.val(d)},a.fn.insertEmpltyLink=function(){var a=this,c=a.$txt,d=c.children();return 0===d.length?void c.append(b("<p><br></p>")):void("<br>"!==d.last().html()&&c.append(b("<p><br></p>")))},a.fn.setTapNumForHideMenu=function(a){var b=this,c=b.tapNumForHideMenu,d=b.config.tapNumForHideMenu;null!=c&&("tap"===a?(b.tapNumForHideMenu=c+1,c>=d&&b.hideMenuByOpenBtn()):"command"===a&&(b.tapNumForHideMenu=c-1))}}),window.___E_mod(function(a,b){a.fn.setMenuContainerPosition=function(){var a=this,c=a.eventTarget(),d=c.offset(),e=d.top,f=d.height,g=e+f,h=a.$txt,i=h.offset(),j=i.top,k=i.left,l=i.height;g>j+l&&(g=j+l-10);var m,n=h.children();0===n.length?(m=b("<p><br></p>"),h.append(m)):m=n.last();var o=m.offset(),p=o.top,q=o.height,r=a.$menuContainer,s=a.$menuContainerOpenBtn,t=g;t>p+q&&(t=p+q);var u=k+1,v=20,w={top:t+"px",left:u+"px","margin-top":v+"px"};r.css(w),s.css(w),a.showMenuContainer()},a.fn.showMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn;a.menuDisplayShow===!1&&(a.showMenu?(b.show(),b.css("opacity","0.9")):(c.show(),c.css("opacity","0.6")),a.menuDisplayShow=!0)},a.fn.hideMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn,d=a.$txt,e=a.$focusElem,f=d.find(".focus-elem");a.menuDisplayShow&&(c.hide(),c.css("opacity","0"),b.hide(),b.css("opacity","0"),a.menuDisplayShow=!1,e&&(e.removeClass("focus-elem"),f.removeClass("focus-elem")))},a.fn.showMenuByOpenBtn=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn;a.showMenu=!0,b.show(),b.css("opacity","0.9"),c.hide(),c.css("opacity","0"),a.tapNumForHideMenu=0},a.fn.hideMenuByOpenBtn=function(){var a=this;a.$menuContainer,a.$menuContainerOpenBtn;a.showMenu=!1,a.hideMenuContainer(),a.tapNumForHideMenu=null}}),window.___E_mod(function(a,b){a.fn.updateMenuStyle=function(){var a=this,c=a.menus;b.each(c,function(a,b){var c=b.updateStyle;c&&c.call(b)})}}),window.___E_mod(function(a,b){var c=/insertimage/i;a.fn.command=function(a,b,d,e,f){var g=this,h=c.test(a),i=function(){document.execCommand(a,!!b,d)};g.customCommand(h,i,e,f)},a.fn.customCommand=function(a,b,c,d){var e=this,f=e.currentRange(),g=e.currentWrapRange();e.$txt;a?e.restoreSelection(f):e.restoreSelection(g),b(),e.insertEmpltyLink(),e.saveSelection(),e.restoreSelection(f),c&&(c.preventDefault(),c.stopPropagation()),d&&d.call(e),e.hideMenuContainer(),e.setTapNumForHideMenu("command")}}),window.___E_mod(function(a,b){a.fn.currentRange=function(a){return a?void(this.currentRangeData=a):this.currentRangeData},a.fn.currentWrapRange=function(a){return a?void(this.currentWrapRangeData=a):this.currentWrapRangeData},a.fn.getWrapRangeElem=function(){var a,b,c=this,d=c.$txt,e=d.attr("class"),f=this.currentWrapRange();c.eventTarget().get(0);return null!=f?(a=f.commonAncestorContainer,b=3===a.nodeType?a.parentNode:a,b.className===e&&(b=d.children().last().get(0)||b),b):void 0},a.fn.saveSelection=function(a){var b,c,d,e=this,f=e.$txt.get(0);a?b=a.commonAncestorContainer:(c=document.getSelection(),c.getRangeAt&&c.rangeCount&&(a=document.getSelection().getRangeAt(0),b=a.commonAncestorContainer)),b&&(f.contains(b)||f===b)&&(e.currentRange(a),d=document.getSelection().getRangeAt(0),d.selectNodeContents(b),e.currentWrapRange(d))},a.fn.restoreSelection=function(a){var b;a&&(b=document.getSelection(),b.removeAllRanges(),b.addRange(a))}}),window.___E_mod(function(a,b){}),window.___E_mod(function(a,b){a.fn.init=function(){var a=this;a.renderTxt(),a.renderMenu(),a.bindDocumentEvent(),a.bindTxtEvent(),a.bindMenuBtnEvent(),a.bindMenuContainerEvent(),a.bindMenuContainerOpenBtnEvent()}});