/*! wangEditor-mobile.js 2015-11-21 */
!function(a){a.___extendJS=function(b){var c=a.___E;null!=c&&b(c,a.Zepto)}}(window),function(a){var b=a.Zepto,c=a.___E,d="github.com/wangfupeng1988/wangEditor-mobile";if(null!=c){if(c.gitlink===d)return void alert("不得重复引用wangEditor的js文件");if(!c.gitlink||c.gitlink!==d)return void alert("window.___E 属性名已经被其他程序占用。wangEditor-mobile引用失败")}return null==b?void alert("wangEditor-mobile依赖于zepto，请先引用zepto.js"):document.createRange&&"function"==typeof document.createRange?void 0:void alert("当前浏览器不支持document.createRange，不能生成富文本编辑器")}(window),function(a,b){var c="github.com/wangfupeng1988/wangEditor-mobile",d=function(a){var c=this,d=b("#"+a);c.$textarea=d,c.tapTime=Date.now(),c.checkTapTime=function(){return Date.now()-c.tapTime<50?!1:(c.tapTime=Date.now(),!0)},c.initDefaultConfig(),c.addTxt(),c.addMenus()};d.fn=d.prototype,d.fn.gitlink=c,d.log=function(b,c){a.console?c?console.log(b,c):console.log(b):(alert(b),c&&alert(c))},a.___E=d}(window,window.Zepto),window.___extendJS(function(a,b){a.config={}}),window.___extendJS(function(a,b){a.fn.initDefaultConfig=function(){var a=this;a.config={menuColorValue:"red",menuQuoteStyle:{display:"block","border-left":"5px solid #d0e5f2",padding:"4px 0 4px 10px","background-color":"#f1f1f1",margin:"4px 0"},menus:["head","bold","color","quote","list","check"]}}}),window.___extendJS(function(a,b){a.fn.addTxt=function(){var a=this,c=a.$textarea,d=b.trim(c.val());d||(d="<p><br></p>");var e=b('<div contentEditable="true" class="wangEditor-mobile-txt">'+d+"</div>"),f=b('<div class="wangEditor-mobile-modal-container"></div>');a.$txt=e,a.$modalContainer=f}}),window.___extendJS(function(a,b){a.fn.addMenus=function(){var a,c=this,d=b('<div contentEditable="false" class="wangEditor-mobile-menu-container"></div>'),e=b('<div class="tip"></div>');d.append(e),c.$menuContainer=d,c.$menuContainerTip=e,c.menus={},a=c.menus,c.addMenuBold("bold"),c.addMenuHead("head"),c.addMenuColor("color"),c.addMenuQuote("quote"),c.addMenuList("list"),c.addMenuCheck("check")}}),window.___extendJS(function(a,b){a.fn.addMenuBold=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-bold"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&c.command("bold",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("bold")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___extendJS(function(a,b){a.fn.addMenuHead=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-header"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&(b.selected?c.command("formatblock",!1,"p"):c.command("formatblock",!1,"h3"))})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^h\d{1}$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___extendJS(function(a,b){a.fn.addMenuColor=function(a){var c=this,d=c.menus||{},e=c.config.menuColorValue;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-brush"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this,d=b.$trigger;d.on("singleTap",function(a){if(c.checkTapTime()!==!1){var d=e;b.selected&&(d="#000"),c.command("forecolor",!1,d,a)}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("forecolor");"rgb(0, 0, 0)"!==d?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___extendJS(function(a,b){a.fn.addMenuQuote=function(a){var c=this,d=c.menus||{},e=(c.$txt,c.config.menuQuoteStyle);d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-quote-left"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=this;d.$trigger.on("singleTap",function(a){if(c.checkTapTime()!==!1){var f="blockquote";d.selected&&(f="p"),c.command("formatblock",!1,f,a),"blockquote"===f&&c.$txt.find("blockquote").each(function(a,c){var d=b(c),f="w_editor_quote_style",g=d.attr(f);null==g&&(d.css(e),d.attr(f,"1"))})}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^blockquote$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___extendJS(function(a,b){a.fn.addMenuList=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-list-ul"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&c.command("InsertUnorderedList",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("InsertUnorderedList")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___extendJS(function(a,b){a.fn.addMenuCheck=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-checkbox-checked"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=Date.now(),e=this;e.$trigger.on("singleTap",function(a){if(c.checkTapTime()!==!1){var e=b('<input type="checkbox"/>'),f=b("<p></p>");f.append(e).append("&nbsp;&nbsp;"),e.on("singleTap",function(a){if(!(Date.now()-d<50)){d=Date.now();var c=b(a.target),e=c.is(":checked");c.prop("checked",!e),a.preventDefault(),a.stopPropagation()}});var g=function(){c.$focusElem.after(f)};c.customCommand(g,a)}})},updateStyle:function(a){}}}}),window.___extendJS(function(a,b){a.fn.renderTxt=function(){var a=this,c=a.$textarea,d=a.$txt,e=a.$modalContainer;c.after(d),c.hide(),b("body").append(e)}}),window.___extendJS(function(a,b){a.fn.renderMenu=function(){var a=this,c=a.menus,d=a.$menuContainer,e=(a.$txt,b('<div class="gap"></div>')),f=a.config.menus;b.each(f,function(a,b){var f=c[b];if(null!=f){var g=f.$trigger,h=f.$wrap;g&&(h?(h.append(g),d.append(h)):d.append(g),d.append(e.clone()))}}),d.children().last().remove(),d.hide(),a.isMenuShow=!1,b("body").append(d)}}),window.___extendJS(function(a,b){a.fn.bindDocumentEvent=function(){var a=b(document),c=this,d=(c.$txt,Date.now());a.on("scroll",function(a){Date.now()-d<=50||(d=Date.now(),c.hideMenuContainer())}),a.on("tap",function(a){})}}),window.___extendJS(function(a,b){a.fn.bindTxtEvent=function(){function a(){var a,d;c.saveSelection(),a=c.getWrapRangeElem(),a&&(d=b(a),d.addClass("focus-elem"),c.$focusElem=d),c.updateMenuStyle()}var c=this,d=c.$txt,e=Date.now();d.on("focus",function(){c.isFocus=!0}),d.on("touchstart",function(a){c.touchEvent=a}),d.on("singleTap",function(d){if(c.checkTapTime()!==!1&&c.isFocus){if(b(d.target).hasClass("focus-elem"))return void c.hideMenuContainer();c.setMenuContainerPosition(c.touchEvent,b(d.target));var e=c.$focusElem;e&&e.removeClass("focus-elem"),setTimeout(a,c.txtTapDelay),c.txtTapDelay=100,d.stopPropagation()}}),d.on("scroll",function(a){Date.now()-e<=50||(e=Date.now(),c.hideMenuContainer(),a.stopPropagation())}),d.on("keydown",function(a){c.hideMenuContainer()}),d.on("longTap, doubleTap",function(){c.hideMenuContainer()}),d.on("blur",function(a){c.isFocus=!1,c.hideMenuContainer(),c.saveSourceCode()}),d.on("click",function(a){a.preventDefault(),a.stopPropagation()})}}),window.___extendJS(function(a,b){a.fn.bindMenuContainerEvent=function(){var a=this,b=a.$menuContainer;b.on("tap",function(a){a.preventDefault(),a.stopPropagation()})}}),window.___extendJS(function(a,b){a.fn.bindMenuBtnEvent=function(){var a=this,c=a.menus;b.each(c,function(b,c){var d=c.bindEvent;d&&"function"==typeof d&&d.call(c,a)})}}),window.___extendJS(function(a,b){a.fn.focusTxt=function(){var a=this,b=a.$txt;b.focus()},a.fn.saveSourceCode=function(){var a=this,b=a.$txt,c=a.$textarea,d="",e=b.clone(),f=e.find(".focus-elem");f.removeClass("focus-elem"),d=e.html(),c.val(d)}}),window.___extendJS(function(a,b){a.fn.setMenuContainerPosition=function(a,c){var d,e=this,f=a.pageX,g=a.pageY,h=e.$txt,i=h.children();0===i.length?(d=b("<p><br></p>"),h.append(d)):d=i.last();var j,k,l=d.offset(),m=l.top,n=l.height,o=e.$menuContainer,p=e.$menuContainerTip,q=g;g>m+n&&(q=m+n);var r=f,s=20,t=0-f+10;o.css({top:q+"px",left:r+"px","margin-left":t+"px","margin-top":s+"px"}),e.showMenuContainer(),k=0-t-10,10>=k&&(k=10),j=o.offset().width,k>j-30&&(k=j-30),p.css("margin-left",k+"px")},a.fn.showMenuContainer=function(){var a=this,b=a.$menuContainer;a.isMenuShow===!1&&(b.show(),b.css("opacity","0.9"),a.isMenuShow=!0)},a.fn.hideMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$txt,d=a.$focusElem,e=c.find(".focus-elem");a.isMenuShow&&(b.hide(),b.css("opacity","0"),a.isMenuShow=!1,d&&(d.removeClass("focus-elem"),e.removeClass("focus-elem")))}}),window.___extendJS(function(a,b){a.fn.updateMenuStyle=function(){var a=this,c=a.menus;b.each(c,function(a,b){var c=b.updateStyle;c&&c.call(b)})}}),window.___extendJS(function(a,b){a.fn.command=function(a,b,c,d,e){var f=this,g=function(){document.execCommand(a,!!b,c)};f.customCommand(g,d,e)},a.fn.customCommand=function(a,c,d){var e=this,f=e.currentRange(),g=e.currentWrapRange(),h=e.$txt;e.restoreSelection(g),a(),"<br>"!==h.children().last().html()&&h.append(b("<p><br></p>")),e.saveSelection(),e.restoreSelection(f),c&&(c.preventDefault(),c.stopPropagation()),d&&d.call(e),e.hideMenuContainer()}}),window.___extendJS(function(a,b){a.fn.currentRange=function(a){return a?void(this.currentRangeData=a):this.currentRangeData},a.fn.currentWrapRange=function(a){return a?void(this.currentWrapRangeData=a):this.currentWrapRangeData},a.fn.getWrapRangeElem=function(){var a,b=this.currentWrapRange();return null!=b?(a=b.commonAncestorContainer,3===a.nodeType&&(a=a.parentNode),a):void 0},a.fn.saveSelection=function(a){var b,c,d,e=this,f=e.$txt.get(0);a?b=a.commonAncestorContainer:(c=document.getSelection(),c.getRangeAt&&c.rangeCount&&(a=document.getSelection().getRangeAt(0),b=a.commonAncestorContainer)),b&&(f.contains(b)||f===b)&&(e.currentRange(a),d=document.getSelection().getRangeAt(0),d.selectNodeContents(b),e.currentWrapRange(d))},a.fn.restoreSelection=function(a){var b;a&&(b=document.getSelection(),b.removeAllRanges(),b.addRange(a))}}),window.___extendJS(function(a,b){}),window.___extendJS(function(a,b){a.fn.init=function(){var a=this;a.renderTxt(),a.renderMenu(),a.bindDocumentEvent(),a.bindTxtEvent(),a.bindMenuBtnEvent(),a.bindMenuContainerEvent()}});